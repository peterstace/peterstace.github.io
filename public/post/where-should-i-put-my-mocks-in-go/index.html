<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Where should I put my mocks in Go?  &middot; Much Ado About Much</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="" />

<meta name="keywords" content="golang, go, mock, test, testing, production, binary, stub, package, API, godoc, gomock, ">


<meta property="og:title" content="Where should I put my mocks in Go?  &middot; Much Ado About Much ">
<meta property="og:site_name" content="Much Ado About Much"/>
<meta property="og:url" content="http://localhost:1313/post/where-should-i-put-my-mocks-in-go/" />
<meta property="og:locale" content="en-us">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2015-05-21T21:51:39&#43;11:00" />
<meta property="og:article:modified_time" content="2015-05-21T21:51:39&#43;11:00" />

  
    
<meta property="og:article:tag" content="golang">
    
<meta property="og:article:tag" content="go">
    
<meta property="og:article:tag" content="mock">
    
<meta property="og:article:tag" content="test">
    
<meta property="og:article:tag" content="testing">
    
<meta property="og:article:tag" content="production">
    
<meta property="og:article:tag" content="binary">
    
<meta property="og:article:tag" content="stub">
    
<meta property="og:article:tag" content="package">
    
<meta property="og:article:tag" content="API">
    
<meta property="og:article:tag" content="godoc">
    
<meta property="og:article:tag" content="gomock">
    
  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@" />
<meta name="twitter:creator" content="@" />
<meta name="twitter:title" content="Where should I put my mocks in Go?" />
<meta name="twitter:description" content="" />
<meta name="twitter:url" content="http://localhost:1313/post/where-should-i-put-my-mocks-in-go/" />
<meta name="twitter:domain" content="http://localhost:1313">
  

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "Where should I put my mocks in Go?",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+?rel=author"
    },
    "datePublished": "2015-05-21",
    "description": "",
    "wordCount":  503 
  }
</script>



<link rel="canonical" href="http://localhost:1313/post/where-should-i-put-my-mocks-in-go/" />

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:1313/touch-icon-144-precomposed.png">
<link href="http://localhost:1313/favicon.png" rel="icon">

<meta name="generator" content="Hugo 0.14" />

  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->



    <link rel="stylesheet" href="http://localhost:1313/css/theme/default.css">


<link rel="stylesheet" href="http://localhost:1313/css/font-awesome.min.css">
<link rel="stylesheet" href="http://localhost:1313/css/style.css">


  <link rel="stylesheet" href="http://localhost:1313/css/highlight/default.css">


</head>
<body>
    <header id="main-header">
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://localhost:1313">Much Ado About Much</a>
      </div>
      <div id="navbar" class="collapse navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          
        </ul>
      </div>
      
    </div>
  </nav>

</header>


<div class="container">
<div class="row">

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  <div class="text-center">

    <h1>Where should I put my mocks in Go?
</h1>

    <div class="metas">
<small>
  <i class="fa fa-calendar"></i>
  <time datetime="2015-05-21">21 May, 2015</time>
</small>


  <small>
  &middot; Read in about 3 min
  &middot; (503 Words)
</small>


<div class="margin-10">
  <i class="fa fa-tags"></i>
  
  <a href="http://localhost:1313/tags/golang" class="label label-primary">golang</a>
  
  <a href="http://localhost:1313/tags/go" class="label label-primary">go</a>
  
  <a href="http://localhost:1313/tags/mock" class="label label-primary">mock</a>
  
  <a href="http://localhost:1313/tags/test" class="label label-primary">test</a>
  
  <a href="http://localhost:1313/tags/testing" class="label label-primary">testing</a>
  
  <a href="http://localhost:1313/tags/production" class="label label-primary">production</a>
  
  <a href="http://localhost:1313/tags/binary" class="label label-primary">binary</a>
  
  <a href="http://localhost:1313/tags/stub" class="label label-primary">stub</a>
  
  <a href="http://localhost:1313/tags/package" class="label label-primary">package</a>
  
  <a href="http://localhost:1313/tags/api" class="label label-primary">API</a>
  
  <a href="http://localhost:1313/tags/godoc" class="label label-primary">godoc</a>
  
  <a href="http://localhost:1313/tags/gomock" class="label label-primary">gomock</a>
  


</div>
<br>
</div>

  </div>
</div>

  <div class="container content">
  

<h2 id="introduction:a3d7580a82f7d628d598e820061112ef">Introduction</h2>

<p>Go&rsquo;s toolchain provides a mechanism to help prevent test code from being
included in production binaries. It should be obvious why this is useful; if
stubs or mocks intended for testing make their way your production system, they
may cause it to fail silently in catastrophic and unexpected ways. This is
especially a concern if you don&rsquo;t have automated application and integration
tests in place. Imagine if you somehow end up with a stubbed out authentication
manager that always returns <code>true</code> when asked if a user has administration
privileges. Yikes.</p>

<p>This blog post will explain this mechanism, along with some of the ways you can
most effectively take advantage it, especially when dealing with mocks and
stubs.</p>

<h2 id="the-mechanism:a3d7580a82f7d628d598e820061112ef">The Mechanism</h2>

<p>It&rsquo;s well known that the <code>go test</code> tool looks in files that end in <code>_test.go</code>
for tests to run. What is less well known is that these <code>*_test.go</code> files are
<em>excluded</em> from binaries built using <code>go build</code> and <code>go install</code>.</p>

<p>Excellent! This means we can put all of our testing stubs and mocks in the
<code>*_test.go</code> files and they will never accidentally be included in production
binaries!</p>

<h2 id="the-problem:a3d7580a82f7d628d598e820061112ef">The Problem</h2>

<p>This works well most of the time. You have an interface <code>Foo</code> declared in
package <code>foo</code>, and a mocked out implementation <code>MockFoo</code> also in package <code>foo</code>
but in a file named <code>mock_foo_test.go</code>. This works great, you can use <code>MockFoo</code>
instead of the real implementation for all of your tests in package <code>foo</code>!</p>

<p>But what if you want to use <code>MockFoo</code> for tests in packages <code>garply</code> and
<code>waldo</code>? Unfortunately you can&rsquo;t. Because <code>MockFoo</code> is declared in a file
ending in <code>_test.go</code>, it can only be used in tests contained in the same
package.</p>

<h2 id="the-solutions:a3d7580a82f7d628d598e820061112ef">The Solutions</h2>

<p>There are a two obvious ways to work around this:</p>

<ul>
<li>Rename the file containing <code>MockFoo</code> from <code>mock_foo_test.go</code> to
<code>mock_foo.go</code>. Now that it&rsquo;s not a test file, it can be accessed from other
packages.</li>
<li>Copy <code>mock_foo_test.go</code> into the other packages that need it (modifying the
package declaration to match its destination package).</li>
</ul>

<p>There are some drawbacks to both approaches.</p>

<p>In the first approach, we lose the guarantee that <code>MockFoo</code> won&rsquo;t accidentally
be included the production binary.  As an additional annoyance, <code>MockFoo</code> is
now part of the public API, and as such will appear in listings produced by the
<code>godoc</code> tool.</p>

<p>The second approach violates the <a href="http://c2.com/cgi/wiki?DontRepeatYourself">DRY
principal</a>. If the interface
changes, you then have to go and change all of the mocks. If you&rsquo;re manually
rolling your own mocks, the process of updating them all could be error prone.</p>

<p>In my opinion, the second approach is the better of the two, especially when
considering that mocks can be generated automatically with tools such as
<a href="https://code.google.com/p/gomock/">gomock</a>. If you write a small script that
generates all of the mocks in your project using gomock, then you just have to
run it whenever you change an interface that is being mocked out. Since the
mocks are generated <em>from</em> the interface, I don&rsquo;t think that the DRY principal
is of great importance here.</p>

<p>Happy testing!</p>

</div>


  <footer>
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      
  
    <nav><ul class="pager">
    

    
      <li class="next">
        <a href="http://localhost:1313/post/go-gofmt-and-diff/" title="Go, gofmt, and diffs">
            Next <span aria-hidden="true">&rarr;</span>
        </a>
      </li>
    
    </ul> </nav>
  


</div>

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  

</div>

</footer>


</div>
</div>
      <footer class="footer">
    <div class="container hidden-print">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
           <div class="pull-left">
  <a class="toplink" href="#">back to top</a>
</div>
<div class="pull-right">
  
</div>

        </div>
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 text-center">
          <small>
              
    
<div class="container footline">
  

</div>


    


          </small>
        </div>
     </div>
    </div>
</footer>

    <script src="http://localhost:1313/js/jquery.min-2.1.4.js"></script>
<script src="http://localhost:1313/js/bootstrap.min-3.3.5.js"></script>




<script src="http://localhost:1313/js/highlight.pack.js"></script>
<script src="http://localhost:1313/js/site.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



  <script data-no-instant>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body>
</html>

